# --------------------------------------------------------------------
# Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com).
#
# WSO2 LLC. licenses this file to you under the Apache License,
# Version 2.0 (the "License"); you may not use this file except
# in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# --------------------------------------------------------------------

# CLI Integration Test Configuration
# ===================================
# Enable/disable tests and view their dependencies.
# Set 'enabled: false' to skip specific tests.
# Phase 1 infrastructure starts automatically based on enabled test dependencies.
#
# Infrastructure IDs:
#   CLI            - CLI binary (ap)
#   GATEWAY_IMAGES - Gateway Docker images (built from source)
#   GATEWAY        - Gateway stack (controller, router, policy-engine, sample-backend)
#   MCP_SERVER     - MCP server backend

# Infrastructure configuration
infrastructure:
  compose_file: ../../gateway/it/docker-compose.test.yaml
  startup_timeout: 120s
  health_check_interval: 5s

# Test definitions with dependencies
tests:
  gateway:
    manage:
      - id: GW-MANAGE-001
        name: gateway add with valid parameters
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-002
        name: gateway add without name flag
        enabled: true
        requires: [CLI]

      - id: GW-MANAGE-003
        name: gateway add with invalid server URL
        enabled: true
        requires: [CLI]

      - id: GW-MANAGE-004
        name: gateway add duplicate name
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-005
        name: gateway list
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-006
        name: gateway list when empty
        enabled: true
        requires: [CLI]

      - id: GW-MANAGE-007
        name: gateway remove existing
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-008
        name: gateway remove non-existent
        enabled: true
        requires: [CLI]

      - id: GW-MANAGE-009
        name: gateway use existing
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-010
        name: gateway use non-existent
        enabled: true
        requires: [CLI]

      - id: GW-MANAGE-011
        name: gateway current
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-012
        name: gateway current when none set
        enabled: true
        requires: [CLI]

      - id: GW-MANAGE-013
        name: gateway health
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MANAGE-014
        name: gateway health unreachable
        enabled: true
        requires: [CLI]

    apply:
      - id: GW-APPLY-001
        name: apply valid API yaml
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-APPLY-002
        name: apply invalid yaml format
        enabled: true
        requires: [CLI]

      - id: GW-APPLY-003
        name: apply missing file
        enabled: true
        requires: [CLI]

      - id: GW-APPLY-004
        name: apply valid MCP yaml
        enabled: true
        requires: [CLI, GATEWAY, MCP_SERVER]

    api:
      - id: GW-API-001
        name: api list
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-API-002
        name: api list empty
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-API-003
        name: api get existing
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-API-004
        name: api get non-existent
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-API-005
        name: api delete existing
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-API-006
        name: api delete non-existent
        enabled: true
        requires: [CLI, GATEWAY]

    mcp:
      - id: GW-MCP-001
        name: mcp generate valid server
        enabled: true
        requires: [CLI, MCP_SERVER]

      - id: GW-MCP-002
        name: mcp generate invalid server URL
        enabled: true
        requires: [CLI]

      - id: GW-MCP-003
        name: mcp generate unreachable server
        enabled: true
        requires: [CLI]

      - id: GW-MCP-004
        name: mcp list
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MCP-005
        name: mcp list empty
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MCP-006
        name: mcp get existing
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MCP-007
        name: mcp get non-existent
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MCP-008
        name: mcp delete existing
        enabled: true
        requires: [CLI, GATEWAY]

      - id: GW-MCP-009
        name: mcp delete non-existent
        enabled: true
        requires: [CLI, GATEWAY]

    build:
      - id: GW-BUILD-001
        name: build invalid manifest
        enabled: true
        requires: [CLI]

      - id: GW-BUILD-002
        name: build missing manifest file
        enabled: true
        requires: [CLI]
