events {}

http {
  # Use Docker's internal DNS server for dynamic upstream resolution
  resolver 127.0.0.11 valid=10s;

  server {
    listen 8443 ssl;
    server_name localhost;

    ssl_certificate     /etc/nginx/certs/default-listener.crt;
    ssl_certificate_key /etc/nginx/certs/default-listener.key;

    ssl_protocols TLSv1.2 TLSv1.3;

    location / {
      # Use variable to force runtime DNS resolution
      set $upstream http://mock-openapi:4010;
      proxy_pass $upstream;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-Proto https;
    }
  }
}
