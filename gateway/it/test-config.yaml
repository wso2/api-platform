gateway_controller:

  # Server configuration
  server:
    # REST API port for gateway management
    api_port: 9090

    # xDS gRPC port for Envoy communication
    xds_port: 18000

    # Graceful shutdown timeout
    shutdown_timeout: 15s

  # Policy xDS Server configuration
  policyserver:
    # Enable or disable the policy xDS server
    enabled: true

    # Policy xDS gRPC port for policy distribution
    port: 18001

    # TLS configuration for secure policy xDS communication
    tls:
      # Enable or disable TLS
      enabled: false

      # Path to TLS certificate file (required if TLS is enabled)
      cert_file: "./certs/server.crt"

      # Path to TLS private key file (required if TLS is enabled)
      key_file: "./certs/server.key"

  # Storage configuration
  storage:
    # Storage type: "sqlite", "postgres" (future), or "memory"
    # - sqlite: Use SQLite embedded database for persistence
    # - postgres: Use PostgreSQL database for persistence (future support)
    # - memory: No persistent storage, all configs lost on restart (useful for testing)
    type: sqlite

    # SQLite configuration (used when type=sqlite)
    sqlite:
      path: ./data/gateway.db

  # Policy configuration
  policies:
    # Directory containing policy definitions
    definitions_path: ./default-policies

  # Router (Envoy) configuration
  router:
    # Gateway host for incoming requests
    gateway_host: "*"
    # Event Gateway (WebSub Hub) configuration
    event_gateway:
      enabled: false
      websub_hub_url: "http://host.docker.internal"
      websub_hub_port: 9098
      router_host: "localhost"
      websub_hub_listener_port: 8083
      timeout_seconds: 10
    # Access logs configuration
    access_logs:
      # Enable or disable access logs
      enabled: true

      # Log format: "json" or "text"
      # - json: Structured JSON format (recommended for log aggregation)
      # - text: Human-readable text format
      format: json

      # JSON format fields - key-value pairs for structured logging
      # Uses Envoy command operators: https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage
      json_fields:
        start_time: "%START_TIME%"
        method: "%REQ(:METHOD)%"
        path: "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%"
        protocol: "%PROTOCOL%"
        response_code: "%RESPONSE_CODE%"
        response_flags: "%RESPONSE_FLAGS%"
        response_flags_long: "%RESPONSE_FLAGS_LONG%"
        bytes_received: "%BYTES_RECEIVED%"
        bytes_sent: "%BYTES_SENT%"
        duration: "%DURATION%"
        upstream_service_time: "%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%"
        x_forwarded_for: "%REQ(X-FORWARDED-FOR)%"
        user_agent: "%REQ(USER-AGENT)%"
        request_id: "%REQ(X-REQUEST-ID)%"
        authority: "%REQ(:AUTHORITY)%"
        upstream_host: "%UPSTREAM_HOST%"
        upstream_cluster: "%UPSTREAM_CLUSTER%"

      # Text format template - used when format is "text"
      # Uses Envoy command operators: https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage
      text_format: |
        [%START_TIME%] "%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%" %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION% "%REQ(X-FORWARDED-FOR)%" "%REQ(USER-AGENT)%" "%REQ(X-REQUEST-ID)%" "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%"

    # Listener port for incoming HTTP traffic (Envoy proxy port)
    listener_port: 8080

    # HTTPS listener configuration
    https_enabled: true  # Enable/disable HTTPS listener
    https_port: 8443      # HTTPS listener port

    # Downstream TLS configuration (for HTTPS listener)
    downstream_tls:
      # Path to server certificate (PEM format)
      cert_path: "./listener-certs/default-listener.crt"
      
      # Path to server private key (PEM format)
      key_path: "./listener-certs/default-listener.key"
      
      # Minimum TLS protocol version (TLS1_0, TLS1_1, TLS1_2, TLS1_3)
      minimum_protocol_version: TLS1_2
      
      # Maximum TLS protocol version (TLS1_0, TLS1_1, TLS1_2, TLS1_3)
      maximum_protocol_version: TLS1_3
      
      # Cipher suites (comma-separated)
      ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,AES128-GCM-SHA256,AES128-SHA,ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,AES256-GCM-SHA384,AES256-SHA"

    # Upstream configuration
    envoy_upstream:
      # TLS configuration for upstream connections
      tls:
        minimum_protocol_version: TLS1_2
        maximum_protocol_version: TLS1_3
        ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,AES128-GCM-SHA256,AES128-SHA,ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,AES256-GCM-SHA384,AES256-SHA"
        trusted_cert_path: /etc/ssl/certs/ca-certificates.crt
        custom_certs_path: ./certificates  # Directory containing custom trusted certificates (e.g., self-signed certs)
        verify_host_name: true
        disable_ssl_verification: false

      # Timeout configurations for upstream connections (milliseconds; 6000 = 6s for fast backend_timeout it scenario global-default)
      timeouts:
        route_timeout_in_milliseconds: 6000
        max_route_timeout_in_milliseconds: 6000
        route_idle_timeout_in_milliseconds: 300000

      # Default cluster settings for API upstream clusters (e.g. connect timeout)
      envoy_upstream_cluster:
        connect_timeout_in_milliseconds: 5000
    tracing_service_name: router


    # Policy Engine ext_proc filter configuration
    policy_engine:
      # Enable or disable policy engine ext_proc filter
      enabled: true

      # Policy engine host (hostname or IP address)
      host: policy-engine

      # Policy engine ext_proc port
      port: 9001

      # Timeout for gRPC service connection (in milliseconds)
      timeout_ms: 60000

      # Failure mode: false = fail closed (deny requests on error), true = fail open (allow requests on error)
      failure_mode_allow: false

      # Route cache action: DEFAULT, RETAIN, or CLEAR
      # RETAIN: Maintain the route cache across requests (recommended for performance)
      route_cache_action: RETAIN

      # Allow per-route override of ext_proc configuration
      allow_mode_override: true

      # Request header processing mode: DEFAULT, SEND, or SKIP
      # SEND: Forward request headers to policy engine for processing
      request_header_mode: SEND

      # Message timeout for policy engine processing (in milliseconds)
      message_timeout_ms: 60000

      # TLS configuration for policy engine connection
      tls:
        # Enable TLS for secure communication with policy engine
        enabled: false

        # Client certificate path (for mutual TLS authentication)
        cert_path: ""

        # Client private key path (for mutual TLS authentication)
        key_path: ""

        # CA certificate path (for server certificate validation)
        ca_path: ""

        # Server name for SNI (optional, defaults to host)
        server_name: ""

        # Skip server certificate verification (insecure, development only)
        skip_verify: false


  # Authentication configuration
  # - If BOTH `basic.enabled` and `idp.enabled` are false, all requests are allowed without authentication.
  # - `users`: List of locally defined users (username/password + local roles).
  #   Passwords can be plain text or hashed depending on your implementation. We support argon2id and bcrypt hashing.
  # - `idp`: Optional IDP (OIDC/JWKS) configuration to validate incoming JWTs.
  #   `role_mapping` maps local roles to one or more roles in the IDP.
  # - Wildcard role mapping: configure at most ONE local role with `"*"` in `role_mapping` (multiple wildcards are rejected)
  auth:
    # Local basic authentication configuration
    basic:
      enabled: true
    # Local users
      users:
        # Example user entries:
        # - username: "user1"
        #   password: "$argon2id.."   # encrypted hash or plain string depending on implementation
        #   password_hashed: true
        #   roles: ["developer", "viewer"]
      - username: "admin"
        password: "admin"
        password_hashed: false
        roles: ["admin"]
    # IDP (OIDC/JWKS) configuration for validating JWTs (optional)
    # When enabled, JWT tokens will be validated for authentication.
    # If roles_claim and role_mapping are not provided, authorization is bypassed and all authenticated calls are allowed.
    # If roles_claim and role_mapping are provided, authorization happens using the specified claim and mapping.
    idp:
      enabled: false
      # JWKS endpoint used to fetch public keys for JWT validation
      jwks_url: ""
      # Expected issuer value in the JWT `iss` claim
      issuer: ""

  # Metrics configuration
  metrics:
    # Enable or disable Prometheus metrics endpoint
    enabled: true

    # Port for metrics HTTP server
    port: 9091

  # Logging configuration
  logging:
    # Log level: "debug", "info", "warn", or "error"
    level: debug

    # Log format: "json" or "console"
    # - json: Structured JSON format (recommended for production)
    # - console: Human-readable console format (recommended for development)
    format: json

policy_engine:
  server:
    # Port for ext_proc gRPC server (receives requests from Envoy)
    extproc_port: 9001

  # Admin HTTP server configuration
  admin:
    # Enable admin HTTP server for debugging endpoints
    enabled: true

    # Port for admin HTTP server
    port: 9002

    # IP addresses allowed to access the admin API
    # Defaults to localhost only for security
    allowed_ips:
      - "*"
      - "127.0.0.1"

  config_mode:
    # Configuration mode: "file" or "xds"
    # - file: Load policy chains from static YAML file
    # - xds: Subscribe to xDS server for dynamic configuration updates
    mode: xds

  # xDS client configuration
  xds:
    # Enable xDS client
    enabled: true

    # xDS server address (typically the gateway-controller xDS server)
    server_address: gateway-controller:18001

    # Node identifier for this policy engine instance
    # Used by xDS server to identify this client
    node_id: policy-engine-1

    # Cluster identifier for this policy engine instance
    # Used for grouping multiple policy engine instances
    cluster: policy-engine-cluster

    # Connection timeout for establishing initial connection
    connect_timeout: 10s

    # Request timeout for individual xDS requests
    request_timeout: 5s

    # Initial delay before reconnecting after connection failure
    initial_reconnect_delay: 1s

    # Maximum delay between reconnection attempts (exponential backoff)
    max_reconnect_delay: 60s

    # TLS configuration for xDS connection
    tls:
      enabled: false
      # cert_path: /path/to/client-cert.pem
      # key_path: /path/to/client-key.pem
      # ca_path: /path/to/ca-cert.pem

  # File-based configuration (not used in xDS mode)
  file_config:
    path: ""

  # Metrics configuration
  metrics:
    # Enable or disable Prometheus metrics endpoint
    enabled: true

    # Port for metrics HTTP server
    port: 9003

  # Logging configuration
  logging:
    # Log level: debug, info, warn, error
    level: debug

    # Log format: json, text
    format: json

policy_configurations:
  # JWT Authentication Policy Configuration
  jwtauth_v010:
    keymanagers:
      - name: mock-jwks
        issuer: "http://mock-jwks:8080/token"
        jwks:
          remote:
            uri: "http://mock-jwks:8080/jwks"
      - name: wrong-issuer-km
        issuer: "http://expected-issuer.com"
        jwks:
          remote:
            uri: "http://mock-jwks:8080/jwks"
    jwkscachettl: "5m"
    jwksfetchtimeout: "5s"
    jwksfetchretrycount: 3
    jwksfetchretryinterval: "2s"
    allowedalgorithms:
      - "RS256"
      - "ES256"
    leeway: "30s"
    authheaderscheme: "Bearer"
    headername: "Authorization"
    onfailurestatuscode: 401
    errormessageformat: "json"
    errormessage: "Authentication failed"
    validateissuer: true

  # Rate Limiting Policy Configuration
  # See documentation: docs/gateway/policies/ratelimit.md
  ratelimit_v010:
    # Rate limiting algorithm: "gcra" (smooth rate limiting with burst support) or "fixed-window" (simple counter)
    algorithm: fixed-window

    # Storage backend: "memory" for single-instance or "redis" for distributed rate limiting
    backend: memory

    # In-memory storage configuration (only used when backend=memory)
    memory:
      maxEntries: 10000
      cleanupInterval: "5m"

    # Control which rate limit headers are included in responses
    headers:
      includeXRateLimit: true
      includeIETF: true
      includeRetryAfter: true

  # Model Weighted Round-Robin Policy Configuration
  modelweightedroundrobin_v010:
    requestModel:
      location: payload
      identifier: $.model

  # Model Round-Robin Policy Configuration
  modelroundrobin_v010:
    requestModel:
      location: payload
      identifier: $.model

analytics:
  enabled: true
  # Allow capturing and forwarding request/response bodies into analytics pipeline (including publishers like Moesif).
  allow_payloads: false
  # Publishers specific configuration
  publishers:
    - type: moesif
      enabled: true
      settings: 
        # Moesif application ID
        application_id: <MOESIF_APPLICATION_ID>
        # Moesif API endpoint; optional, defaults to https://api.moesif.net
        moesif_base_url: "https://api.moesif.net"
        # Publish interval in seconds
        publish_interval: 5
        # Max number of events held in memory before dropping
        event_queue_size: 10000
        # Max number of events in a batch
        batch_size: 50
        # Time interval in seconds to wake up the timer
        timer_wakeup_seconds: 3

  # gRPC Access Log Service configuration for router(Envoy)
  grpc_access_logs:
    # ALS Server hostname
    host: policy-engine
    
    # Log name identifier
    log_name: "envoy_access_log"
    
    # Buffer settings
    buffer_flush_interval: 1000000000 # nanoseconds
    buffer_size_bytes: 16384
    grpc_request_timeout: 20000000000 # nanoseconds

  # ALS server related configuration
  access_logs_service:
    # ALS Server gRPC  port
    als_server_port: 18090

    # shutdown timeout for the ALS server
    shutdown_timeout: 600 #seconds

    # public and private key path for the ALS server
    public_key_path: ""
    private_key_path: "" 

    # whether to use plain text for the ALS server
    als_plain_text: true

    # max message size for the ALS server
    max_message_size: 1000000000

    # max header limit for the ALS server
    max_header_limit: 8192

tracing:
  enabled: false
  endpoint: otel-collector:4317
  insecure: true
  service_version: "1.0.0"
  batch_timeout: 1s
  max_export_batch_size: 512
  sampling_rate: 1.0

# Azure Content Safety Configuration
azurecontentsafety_endpoint: "http://mock-azure-content-safety:8080"
azurecontentsafety_key: "test-subscription-key"

# AWS Bedrock Guardrail Configuration
awsbedrock_guardrail_region: "us-east-1"
awsbedrock_guardrail_id: "test-guardrail-id"
awsbedrock_guardrail_version: "DRAFT"
awsbedrock_access_key_id: "test-access-key"
awsbedrock_secret_access_key: "test-secret-key"
awsbedrock_session_token: ""
awsbedrock_role_arn: ""
awsbedrock_role_region: ""
awsbedrock_role_external_id: ""

# Semantic Cache Policy Configuration
embedding_provider: "OPENAI"
embedding_provider_endpoint: "http://mock-embedding-provider:8080/v1/embeddings"
embedding_provider_model: "text-embedding-ada-002"
embedding_provider_dimension: 1536
embedding_provider_api_key: "test-api-key"
vector_db_provider: "REDIS"
vector_db_provider_host: "redis"
vector_db_provider_port: 6379
vector_db_provider_username: "default"
vector_db_provider_password: "redis"
vector_db_provider_database: "0"
vector_db_provider_ttl: 3600

