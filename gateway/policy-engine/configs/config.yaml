# Policy Engine Configuration - xDS Mode
# This configuration uses xDS (Envoy Discovery Service) for dynamic policy chain updates

server:
  # Port for ext_proc gRPC server (receives requests from Envoy)
  extproc_port: 9001

# Admin HTTP server configuration
admin:
  # Enable admin HTTP server for debugging endpoints
  enabled: true

  # Port for admin HTTP server
  port: 9002

  # IP addresses allowed to access the admin API
  # Defaults to localhost only for security
  allowed_ips:
    - "*"
    - "127.0.0.1"

config_mode:
  # Configuration mode: "file" or "xds"
  # - file: Load policy chains from static YAML file
  # - xds: Subscribe to xDS server for dynamic configuration updates
  mode: xds

# xDS client configuration
xds:
  # Enable xDS client
  enabled: true

  # xDS server address (typically the gateway-controller xDS server)
  # Default is localhost:18001 for local development
  # Override via XDS_SERVER_ADDRESS environment variable in Docker Compose
  server_address: localhost:18001

  # Node identifier for this policy engine instance
  # Used by xDS server to identify this client
  node_id: policy-engine-1

  # Cluster identifier for this policy engine instance
  # Used for grouping multiple policy engine instances
  cluster: policy-engine-cluster

  # Connection timeout for establishing initial connection
  connect_timeout: 10s

  # Request timeout for individual xDS requests
  request_timeout: 5s

  # Initial delay before reconnecting after connection failure
  initial_reconnect_delay: 1s

  # Maximum delay between reconnection attempts (exponential backoff)
  max_reconnect_delay: 60s

  # TLS configuration for xDS connection
  tls:
    enabled: false
    # cert_path: /path/to/client-cert.pem
    # key_path: /path/to/client-key.pem
    # ca_path: /path/to/ca-cert.pem

# File-based configuration (not used in xDS mode)
file_config:
  path: ""

# Logging configuration
logging:
  # Log level: debug, info, warn, error
  level: info

  # Log format: json, text
  format: json
