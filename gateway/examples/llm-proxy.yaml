# --------------------------------------------------------------------
# Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com).
#
# WSO2 LLC. licenses this file to you under the Apache License,
# Version 2.0 (the "License"); you may not use this file except
# in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# --------------------------------------------------------------------

version: ai.api-platform.wso2.com/v1
kind: llm/proxy
data:
  name: wso2con-assistant
  version: v1.0
  context: /assistant
  upstream:
    name: wso2-openai-provider
    version: v1.0
  policies:
    semanticPromptGuard:
      - path: /chat/completions
        methods: [ POST ]
        params:
          embeddingService:
            type: string
            value: wso2-claude-provider
          embedding-resource-path:
            type: string
            value: /v1/embeddings
          embedding-model:
            type: string
            value: text-embedding-ada-002
          similarity-threshold:
            type: integer
            value: 80
          prompts:
            type: string
            value: |
              [
              "You are a helpful assistant that provides information about WSO2 products and services.",
              "Answer the questions based on the WSO2 documentation and resources.",
              "If you don't know the answer, just say that you don't know. Don't try to make up an answer."
              ]
      - path: /completions
        methods: [ POST ]
        params:
          embeddingService:
            type: string
            value: wso2-claude-provider
          embedding-resource-path:
            type: string
            value: /v1/embeddings
          embedding-model:
            type: string
            value: text-embedding-ada-002
          similarity-threshold:
            type: integer
            value: 80
          prompts:
            type: string
            value: |
              [
              "You are a helpful assistant that provides information about WSO2 products and services.",
              "Answer the questions based on the WSO2 documentation and resources.",
              "If you don't know the answer, just say that you don't know. Don't try to make up an answer."
              ]
    modelRouting:
      - path: /chat/completions
        methods: [ POST ]
        params:
          model:
            type: string
            value: mistral-small-latest
          endpoint:
            type: string
            value: https://api.mistral.ai/v1