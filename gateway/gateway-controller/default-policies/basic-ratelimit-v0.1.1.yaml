name: basic-ratelimit
version: v0.1.1
description: |
  Simple request rate limiting policy that limits the number of requests per time window.
  Uses route name as the rate limit key. For advanced rate limiting with multi-dimensional
  quotas, weighted costs, and custom key extraction, use the full 'ratelimit' policy.

parameters:
  type: object
  additionalProperties: false
  required: ["limits"]
  properties:
    limits:
      type: array
      description: |
        Array of rate limits. Multiple limits can be specified to enforce different
        time windows (e.g., 10/second AND 1000/hour). All limits are evaluated,
        and the most restrictive limit is enforced.
      minItems: 1
      maxItems: 10
      items:
        type: object
        additionalProperties: false
        required: ["limit", "duration"]
        properties:
          limit:
            type: integer
            description: Maximum number of requests allowed in the duration
            minimum: 1
            maximum: 1000000000
          duration:
            type: string
            description: |
              Time window for the limit (Go duration string format).
              Examples: "1s" (1 second), "1m" (1 minute), "1h" (1 hour), "24h" (1 day)
            pattern: "^[0-9]+(ns|us|Âµs|ms|s|m|h)$"

systemParameters:
  type: object
  additionalProperties: false
  properties:
    algorithm:
      type: string
      description: |
        Rate limiting algorithm to use:
        - gcra: Generic Cell Rate Algorithm (default). Provides smooth rate limiting
          with burst support and token bucket semantics. Better for consistent traffic
          shaping and burst handling.
        - fixed-window: Simple fixed time window counter. Divides time into fixed
          intervals and counts requests per window. Lower computational overhead,
          but can allow up to 2x burst at window boundaries.
      enum: ["gcra", "fixed-window"]
      default: "gcra"
      "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.algorithm}"

    backend:
      type: string
      description: |
        Rate limit storage backend. 'memory' for in-memory storage (single-instance),
        'redis' for distributed rate limiting across multiple gateway instances.
      enum: ["memory", "redis"]
      default: "memory"
      "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.backend}"

    redis:
      type: object
      description: Redis configuration (only used when backend=redis)
      additionalProperties: false
      properties:
        host:
          type: string
          description: Redis server hostname or IP address
          default: "localhost"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.host}"

        port:
          type: integer
          description: Redis server port
          minimum: 1
          maximum: 65535
          default: 6379
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.port}"

        password:
          type: string
          description: Redis authentication password (optional)
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.password}"

        username:
          type: string
          description: Redis ACL username (optional, Redis 6+)
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.username}"

        db:
          type: integer
          description: Redis database number
          minimum: 0
          maximum: 15
          default: 0
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.db}"

        keyPrefix:
          type: string
          description: Prefix for all Redis keys to avoid conflicts
          default: "ratelimit:v1:"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.keyprefix}"

        failureMode:
          type: string
          description: |
            Behavior when Redis is unavailable. 'open' allows requests through,
            'closed' denies requests. Recommended: 'open' for availability.
          enum: ["open", "closed"]
          default: "open"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.failuremode}"

        connectionTimeout:
          type: string
          description: Redis connection timeout (Go duration string)
          default: "5s"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.connectiontimeout}"

        readTimeout:
          type: string
          description: Redis read timeout (Go duration string)
          default: "3s"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.readtimeout}"

        writeTimeout:
          type: string
          description: Redis write timeout (Go duration string)
          default: "3s"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.redis.writetimeout}"

    memory:
      type: object
      description: In-memory storage configuration (only used when backend=memory)
      additionalProperties: false
      properties:
        maxEntries:
          type: integer
          description: |
            Maximum number of rate limit entries to store in memory.
            Oldest entries are evicted when limit is reached.
          minimum: 100
          maximum: 10000000
          default: 10000
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.memory.maxentries}"

        cleanupInterval:
          type: string
          description: |
            Interval for cleaning up expired entries (Go duration string).
            Use "0" to disable periodic cleanup.
          default: "5m"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v010.memory.cleanupinterval}"
