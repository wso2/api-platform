name: AzureContentSafetyContentModeration
version: v1.0.0
description: |
  Validates request or response body content against Azure Content Safety API for content moderation.
  Supports detection of hate speech, sexual content, self-harm, and violence with configurable severity thresholds.
  Supports JSONPath extraction to validate specific fields within JSON payloads.
  Supports separate configuration for request and response phases.

parameters:
  - name: name
    type: string
    required: true
    description: Name of the guardrail policy for identification
    validation:
      minLength: 1
      maxLength: 256

  - name: request
    type: object
    required: false
    description: Configuration for request phase validation
    properties:
      - name: azureContentSafetyEndpoint
        type: string
        required: true
        description: Azure Content Safety API endpoint URL (without trailing slash)
        validation:
          minLength: 1

      - name: azureContentSafetyKey
        type: string
        required: true
        description: Azure Content Safety API subscription key
        validation:
          minLength: 1

      - name: hateCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for hate category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: sexualCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for sexual category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: selfHarmCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for self-harm category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: violenceCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for violence category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: jsonPath
        type: string
        required: false
        default: ""
        description: |
          JSONPath expression to extract a specific value from JSON payload.
          If empty, validates the entire payload as a string.
          Examples: "$.message", "$.data.content", "$.items[0].text"

      - name: passthroughOnError
        type: boolean
        required: false
        default: false
        description: |
          If true, allows requests to proceed if Azure Content Safety API call fails.
          If false (default), blocks requests on API errors.

      - name: showAssessment
        type: boolean
        required: false
        default: false
        description: |
          If true, includes detailed assessment information in error responses.
          If false, returns minimal error information.

  - name: response
    type: object
    required: false
    description: Configuration for response phase validation
    properties:
      - name: azureContentSafetyEndpoint
        type: string
        required: true
        description: Azure Content Safety API endpoint URL (without trailing slash)
        validation:
          minLength: 1

      - name: azureContentSafetyKey
        type: string
        required: true
        description: Azure Content Safety API subscription key
        validation:
          minLength: 1

      - name: hateCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for hate category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: sexualCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for sexual category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: selfHarmCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for self-harm category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: violenceCategory
        type: integer
        required: false
        default: -1
        description: |
          Severity threshold for violence category (0-7).
          -1 disables this category.
          Content with severity >= threshold will be blocked.
        validation:
          minimum: -1
          maximum: 7

      - name: jsonPath
        type: string
        required: false
        default: ""
        description: |
          JSONPath expression to extract a specific value from JSON payload.
          If empty, validates the entire payload as a string.
          Examples: "$.message", "$.data.content", "$.items[0].text"

      - name: passthroughOnError
        type: boolean
        required: false
        default: false
        description: |
          If true, allows requests to proceed if Azure Content Safety API call fails.
          If false (default), blocks requests on API errors.

      - name: showAssessment
        type: boolean
        required: false
        default: false
        description: |
          If true, includes detailed assessment information in error responses.
          If false, returns minimal error information.

