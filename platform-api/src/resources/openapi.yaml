openapi: 3.1.1
info:
  title: WSO2 API Platform - Platform API
  description: |
    This document specifies a **RESTful API** for WSO2 **API Platform** - **Platform API**.
    
    ## Authentication
    
    All API endpoints (except organization registration) require authentication using JWT access tokens 
    generated by Thunder STS (Security Token Service).
    
    ### JWT Token Requirements
    
    - **Token Format**: Bearer token in Authorization header
    - **Required Claim**: `organization` - UUID of the user's organization
    - **Token Validation**: In development mode, signature validation can be skipped using `JWT_SKIP_VALIDATION=true`
    
    ### Organization Isolation
    
    All API operations are automatically scoped to the organization specified in the JWT token's 
    `organization` claim. Organization IDs are no longer required in request bodies or query parameters.

  version: 1.0.0
  contact:
    name: WSO2 API Platform Team
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: https://localhost:8443/api/v1
    description: Development server (HTTPS)
  - url: https://api.platform.com/api/v1
    description: Production server

security:
  - BearerAuth: []

paths:
  /organizations:
    post:
      summary: Register a new organization
      description: |
        Registers a new organization with a unique UUID and handle. 
        This endpoint is used during the organization onboarding process.
        
        **Note**: This endpoint may be excluded from JWT authentication for initial setup.
      operationId: RegisterOrganization
      tags:
        - Organizations
      security: []  # TODO - Use API-key Auth
      requestBody:
        description: Organization that needs to be added
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Organization'
      responses:
        '201':
          description: Organization registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
            $ref: '#/components/responses/Conflict'
        '500':
            $ref: '#/components/responses/InternalServerError'

    get:
      summary: Get current user's organization
      description: |
        Retrieves the organization details for the organization specified in the JWT token's 
        `organization` claim.
      operationId: GetOrganization
      tags:
        - Organizations
      responses:
        '200':
          description: Organization retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /projects:
    post:
      summary: Create a new project
      description: |
        Creates a new project within the organization specified in the JWT token.
        Organization ID is automatically extracted from the token and does not need to be provided.
      operationId: CreateProject
      tags:
        - Projects
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
            example:
              name: "My Project"
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Get all projects for current user's organization
      description: |
        Retrieves all projects belonging to the organization specified in the JWT token.
        Organization ID is automatically extracted from the token.
      operationId: ListProjects
      tags:
        - Projects
      responses:
        '200':
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /projects/{projectId}:
    get:
      summary: Get project by UUID
      description: |
        Retrieves a specific project by its UUID. Access is validated against the organization 
        in the JWT token to ensure users can only access projects in their organization.
      operationId: GetProject
      tags:
        - Projects
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      responses:
        '200':
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Update project
      description: |
        Updates an existing project's name. Access is validated against the organization 
        in the JWT token.
      operationId: UpdateProject
      tags:
        - Projects
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete project
      description: |
        Deletes a specific project by its UUID. Access is validated against the organization 
        in the JWT token.
      operationId: DeleteProject
      tags:
        - Projects
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      responses:
        '204':
          description: Project deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /import/api-project:
    post:
      summary: Import API project
      description: |
        Imports an API project into the platform from a provided Git Repository URL.
        An API is created from the imported API project and is associated with a specified project within the
        organization in the JWT token.
      operationId: ImportAPIProject
      tags:
        - APIs
      requestBody:
        description: API project import details
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImportAPIProjectRequest'
      responses:
        '201':
          description: API project imported successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/API'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /apis:
    get:
      summary: Get all APIs for an organization
      description: |
        Retrieves all APIs belonging to an organization. Optionally filter by project using 
        the projectId query parameter. Access is validated against the organization in the JWT token.
      operationId: ListAPIs
      tags:
        - APIs
      parameters:
        - $ref: '#/components/parameters/projectId-Q'
      responses:
        '200':
          description: APIs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create a new API
      description: |
        Creates a new API in the platform. The API is associated with a project, which must 
        belong to the organization specified in the JWT token.
      operationId: CreateAPI
      tags:
        - APIs
      requestBody:
        description: API object that needs to be added
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAPIRequest'
        required: true
      responses:
        '201':
          description: API created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/API'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /apis/{apiId}:
    get:
      summary: Get API by UUID
      description: |
        Retrieves a specific API by its UUID. Access is validated against the organization 
        in the JWT token.
      operationId: GetAPI
      tags:
        - APIs
      parameters:
        - $ref: '#/components/parameters/apiID'
      responses:
        '200':
          description: API retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/API'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Update API
      description: |
        Updates an existing API's details. Access is validated against the organization 
        in the JWT token.
      operationId: UpdateAPI
      tags:
        - APIs
      parameters:
        - $ref: '#/components/parameters/apiID'
      requestBody:
        description: API object that needs to be updated
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAPIRequest'
      responses:
        '200':
          description: API updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/API'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete API
      description: |
        Deletes a specific API by its UUID. Access is validated against the organization 
        in the JWT token.
      operationId: DeleteAPI
      tags:
        - APIs
      parameters:
        - $ref: '#/components/parameters/apiID'
      responses:
        '204':
          description: API deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /apis/{apiId}/deploy-revision:
    post:
      tags:
        - API Revisions
      summary: Deploy API Revision
      description: |
        Deploy a revision of an API. Access is validated against the organization 
        in the JWT token.
      operationId: DeployAPIRevision
      parameters:
        - $ref: '#/components/parameters/apiID'
        - $ref: '#/components/parameters/revisionId-Q'
      requestBody:
        description: Deployment object that needs to be added
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/APIRevisionDeployment'
      responses:
        200:
          description: |
            Created.
            Successful response with the newly deployed APIRevisionDeployment List object as the entity in the body.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/APIRevisionDeployment'
        400:
          $ref: '#/components/responses/BadRequest'
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /apis/{apiId}/gateways:
    get:
      summary: Get gateways for API
      description: |
        Retrieves all gateways associated with the specified API, including deployment details.
        Returns gateway information along with association timestamps and deployment status.
        Access is validated against the organization in the JWT token.
      operationId: GetAPIGateways
      tags:
        - APIs
        - Gateways
      parameters:
        - $ref: '#/components/parameters/apiID'
      responses:
        '200':
          description: List of gateways associated with the API, including deployment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIGatewayListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      summary: Add gateways for API
      description: |
        Associates gateways to the specified API. If gateways are already associated,
        updates the association timestamp. Returns all gateways associated with the API
        including deployment details. Access is validated against the organization 
        in the JWT token.
      operationId: AddGatewaysToAPI
      tags:
        - APIs
        - Gateways
      parameters:
        - $ref: '#/components/parameters/apiID'
      requestBody:
        description: List of gateways to associate with the API
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/AddGatewayToAPIRequest'
      responses:
        '200':
          description: List of all gateways associated with the API, including deployment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIGatewayListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /apis/{apiId}/api-portals/publish:
    post:
      summary: Publish API to API Portal
      description: |
        Publishes an existing API from platform-api to the configured API portal.
      operationId: PublishAPIToAPIPortal
      tags:
        - APIs
        - API Portal
      parameters:
        - $ref: '#/components/parameters/apiID'
      responses:
        '200':
          description: API successfully published to API portal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublishAPIResponse'
              example:
                message: "API published successfully to API portal"
                apiId: "1f01c9b2-440b-4cfe-bf48-f8f168062df4"
                apiPortalRefId: "1f01c9b2-440b-4cfe-bf48-f8f168062df4"
                publishedAt: "2025-10-29T21:25:09.418859918+05:30"
        '400':
          description: Bad request - Invalid input or API portal not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidApiId:
                  summary: Invalid API ID format
                  value:
                    code: 400
                    message: Bad Request
                    description: API ID must be a valid UUID
                apiPortalDisabled:
                  summary: API portal not configured
                  value:
                    code: 400
                    message: Bad Request
                    description: API portal integration is not enabled. Set APIPORTAL_ENABLED=true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: API not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                message: Not Found
                description: API with ID 1f01c9b2-440b-4cfe-bf48-f8f168062df4 does not exist
        '500':
          $ref: '#/components/responses/InternalServerError'
        '503':
          description: API portal unavailable after retries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 503
                message: Service Unavailable
                description: Failed to reach API portal after 3 retry attempts (total 60 seconds)

  /apis/{apiId}/api-portals/unpublish:
    post:
      summary: Unpublish API from API Portal
      description: |
        Removes an API from the configured API portal.
      operationId: UnpublishAPIFromAPIPortal
      tags:
        - APIs
        - API Portal
      parameters:
        - $ref: '#/components/parameters/apiID'
      responses:
        '200':
          description: API successfully unpublished from API portal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnpublishAPIResponse'
              example:
                message: "API unpublished successfully from API portal"
                apiId: "1f01c9b2-440b-4cfe-bf48-f8f168062df4"
                unpublishedAt: "2025-10-29T21:08:59.834784232+05:30"
        '400':
          description: Bad request - Invalid input or API portal not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: API not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '503':
          description: API portal unavailable after retries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /gateways:
    post:
      summary: Register a new gateway
      description: |
        Creates a new gateway within the organization specified in the JWT token.
        Organization ID is automatically extracted from the token and does not need to be provided.
      operationId: CreateGateway
      tags:
        - Gateways
      requestBody:
        description: Gateway registration details
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGatewayRequest'
      responses:
        '201':
          description: Gateway registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GatewayResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Gateway name already exists within organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: List all gateways
      description: |
        Retrieves a list of all registered gateways for the organization specified in the JWT token.
        Organization ID is automatically extracted from the token.
      operationId: ListGateways
      tags:
        - Gateways
      responses:
        '200':
          description: Gateways retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GatewayListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gateways/{gatewayId}:
    get:
      summary: Get gateway by UUID
      description: |
        Retrieves a specific gateway by its UUID. Access is validated against the organization 
        in the JWT token.
      operationId: GetGateway
      tags:
        - Gateways
      parameters:
        - $ref: '#/components/parameters/GatewayID'
      responses:
        '200':
          description: Gateway retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GatewayResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Update gateway
      description: |
        Updates an existing gateway's mutable fields (description).
        Access is validated against the organization in the JWT token.
      operationId: UpdateGateway
      tags:
        - Gateways
      parameters:
        - $ref: '#/components/parameters/GatewayID'
      requestBody:
        description: Gateway object that needs to be updated
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGatewayRequest'
      responses:
        '200':
          description: Gateway updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GatewayResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete gateway
      description: |
        Permanently deletes a gateway and all associated tokens (CASCADE).
        Deletion is blocked if the gateway has active API deployments or WebSocket connections.
        Access is validated against the organization in the JWT token.
      operationId: DeleteGateway
      tags:
        - Gateways
      parameters:
        - $ref: '#/components/parameters/GatewayID'
      responses:
        '204':
          description: Gateway deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Conflict. Gateway has active deployments or connections
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                activeDeployments:
                  value:
                    code: 409
                    message: Conflict
                    description: Cannot delete gateway - 3 active API deployment(s) exist
                activeConnections:
                  value:
                    code: 409
                    message: Conflict
                    description: Cannot delete gateway - 2 active connection(s) exist
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gateways/{gatewayId}/tokens:
    post:
      summary: Rotate gateway token
      description: |
        Generates a new authentication token for the gateway. The existing token remains active 
        to enable zero-downtime rotation. Access is validated against the organization in the JWT token.
      operationId: rotateGatewayToken
      tags:
        - Gateway Tokens
      parameters:
        - $ref: '#/components/parameters/GatewayID'
      responses:
        '201':
          description: New token generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenRotationResponse'
        '400':
          description: Bad request (e.g., maximum active tokens reached)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gateways/{gatewayId}/tokens/{tokenId}:
    delete:
      summary: Revoke gateway token
      description: |
        Revokes a specific gateway token. Operation is idempotent - revoking an already-revoked 
        token succeeds. Access is validated against the organization in the JWT token.
      operationId: revokeGatewayToken
      tags:
        - Gateway Tokens
      parameters:
        - $ref: '#/components/parameters/GatewayID'
        - $ref: '#/components/parameters/TokenID'
      responses:
        '200':
          description: Token revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Token revoked successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Gateway or token not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gateways/{gatewayId}/live-proxy-artifacts:
    get:
      summary: Get gateway artifacts
      description: |
        Retrieves all artifacts (APIs, MCPs, API Products) deployed to a specific gateway with pagination support.
        Currently, only APIs are supported as artifacts. Future versions will include MCPs and API Products.
        Access is validated against the organization in the JWT token.
      operationId: GetGatewayArtifacts
      tags:
        - Gateways
        - Artifacts
      parameters:
        - $ref: '#/components/parameters/GatewayID'
        - $ref: '#/components/parameters/ArtifactType-Q'
      responses:
        '200':
          description: Paginated list of artifacts deployed to the gateway
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GatewayArtifactListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /status/gateways:
    get:
      summary: Get gateway status
      description: |
        Retrieves lightweight status information for gateways. This endpoint is optimized for frequent polling 
        by management portals to monitor gateway connection status. If gatewayId query parameter is provided, 
        returns status for that specific gateway only. Otherwise returns status for all gateways in the organization.
      operationId: GetGatewayStatus
      tags:
        - Gateways
      parameters:
        - $ref: '#/components/parameters/gatewayId-Q'
      responses:
        '200':
          description: Gateway status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GatewayStatusListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Gateway not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /git/repo/fetch-branches:
    post:
      summary: Fetch Git repository branches
      description: |
        Fetches and returns the list of branches from a specified public Git repository.
        This endpoint supports multiple Git providers including GitHub, GitLab, and Bitbucket.
        The provider can be specified explicitly or will be auto-detected from the repository URL.
        This endpoint is used to verify repository accessibility and display branch options in the API Platform UI
        for API import functionality. Only public repositories are supported.
      operationId: FetchGitRepoBranches
      tags:
        - Git Operations
      requestBody:
        description: Git repository URL to fetch branches from
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GitRepoBranchesRequest'
      responses:
        '200':
          description: Repository branches fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoBranchesResponse'
        '400':
          description: Invalid repository URL or request payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Repository not found or is private
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '502':
          description: Failed to fetch repository branches from Git provider
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /git/repo/branch/fetch-content:
    post:
      summary: Fetch Git repository content
      description: |
        Fetches and returns the directory and file structure of a specified public Git repository with depth-based pagination.
        This endpoint supports multiple Git providers including GitHub, GitLab, and Bitbucket.
        The provider can be specified explicitly or will be auto-detected from the repository URL.
        
        **Depth-Based Pagination:**
        Use the optional `depth` query parameter to limit repository traversal depth. For example:
        - `depth=1`: Returns only root-level files and directories
        - `depth=2`: Returns files and directories within two levels from the root
        - `depth=0` or omitted: Returns all content (default behavior)
        
        This approach helps balance data completeness and performance by allowing incremental loading of deeper structures.
        The response includes directories (both empty and non-empty) and files at the specified depth levels.
        
        This endpoint is used to verify repository accessibility and display its structure in the API Platform UI
        for API import functionality. Only public repositories are supported.
      operationId: FetchGitRepoContent
      tags:
        - Git Operations
      parameters:
        - $ref: '#/components/parameters/depth-Q'
      requestBody:
        description: Git repository URL to fetch content from
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GitRepoContentRequest'
      responses:
        '200':
          description: Repository content fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoContentResponse'
        '400':
          description: Invalid repository URL or request payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Repository not found or is private
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '502':
          description: Failed to fetch repository content from Git provider
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitRepoError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT access token issued by Thunder STS. The token must contain an `organization` claim 
        that identifies the user's organization. All API operations are automatically scoped 
        to this organization.
        
        Example: `Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...`

  schemas:
    Organization:
      type: object
      required:
        - id
        - handle
        - name
        - region
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the organization
          readOnly: true
          example: "123e4567-e89b-12d3-a456-426614174000"
        handle:
          type: string
          description: URL-friendly unique handle for the organization
          pattern: '^[a-z0-9-]+$'
          minLength: 1
          example: "acme"
        name:
          type: string
          description: Display name of the organization
          example: "Acme Corporation"
        region:
          type: string
          description: Geographic region where the organization operates
          example: "us"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the organization was created
          readOnly: true
          example: "2023-10-12T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the organization was last updated
          readOnly: true
          example: "2023-10-12T10:30:00Z"

    CreateProjectRequest:
      description: |
        Request body for creating a project. Organization ID is automatically extracted
        from the JWT token and does not need to be provided.
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Name of the project
          minLength: 1
          example: "Default Project"
        description:
          type: string
          description: Description of the project
          example: "This is the default project for development"

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          description: Name of the project
          minLength: 1
          example: "Updated Project Name"
        description:
          type: string
          description: Description of the project
          example: "Updated project description"

    Project:
      type: object
      required:
        - name
        - organizationId
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the project
          readOnly: true
          example: "yr434567-de34-76uj6-w376-234324532"
        name:
          type: string
          description: Name of the project
          minLength: 1
          example: "Default Project"
        description:
          type: string
          description: Description of the project
          example: "This is the default project for development"
        organizationId:
          type: string
          format: uuid
          description: UUID of the organization this project belongs to
          readOnly: true
          example: "123e4567-e89b-12d3-a456-426614174000"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the project was created
          readOnly: true
          example: "2023-10-12T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the project was last updated
          readOnly: true
          example: "2023-10-12T10:30:00Z"

    API:
      title: API object
      required:
        - name
        - context
        - version
        - projectId
        - organizationId
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the api artifact
          readOnly: true
          example: 01234567-0123-0123-0123-012345678901
        name:
          minLength: 1
          pattern: '(^[^~!@#;:%^*()+={}|\\<>"'',&$\[\]\/]*$)'
          type: string
          example: PizzaShackAPI
        displayName:
          description: Human-friendly name shown in UI. Length limited to DB column size
          type: string
          example: Pizza Shack API
        description:
          maxLength: 32766
          type: string
          example: This is a simple API for Pizza Shack online pizza delivery store
        context:
          maxLength: 232
          minLength: 1
          type: string
          example: pizza
        version:
          maxLength: 30
          minLength: 1
          type: string
          pattern: '^[^~!@#;:%^*()+={}|\\<>"'',&/$\[\]\s+\/]+$'
          example: 1.0.0
        provider:
          maxLength: 200
          type: string
          description: |
            If the provider value is not given user invoking the api will be used as the provider.
          example: admin
        projectId:
          type: string
          format: uuid
          description: ID of the project this API belongs to
          example: yr434567-de34-76uj6-w376-234324532
        organizationId:
          type: string
          format: uuid
          description: ID of the organization this API belongs to
          readOnly: true
          example: 123e4567-e89b-12d3-a456-426614174000
        createdAt:
          type: string
          format: date-time
          readOnly: true
          description: Timestamp when the api was created
          example: "2023-10-12T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          description: Timestamp when the api was last updated
          example: "2023-10-12T10:30:00Z"
        lifeCycleStatus:
          type: string
          description: Current lifecycle status of the API
          enum:
            - STAGED
            - CREATED
            - PUBLISHED
            - DEPRECATED
            - RETIRED
            - BLOCKED
          example: "CREATED"
        hasThumbnail:
          type: boolean
          example: false
        isDefaultVersion:
          type: boolean
          example: false
        isRevision:
          type: boolean
          example: false
        revisionedApiId:
          type: string
          description: UUID of the api artifact
          readOnly: true
          example: 01234567-0123-0123-0123-012345678901
        revisionId:
          type: integer
          example: 1
        type:
          type: string
          description: The api creation type to be used. Accepted values are HTTP,
            WS, SOAPTOREST, GRAPHQL, WEBSUB, SSE, WEBHOOK, ASYNC
          example: HTTP/REST
          default: HTTP/REST
          enum:
            - HTTP
            - WS
            - SOAPTOREST
            - SOAP
            - GRAPHQL
            - WEBSUB
            - SSE
            - WEBHOOK
            - ASYNC
        transport:
          type: array
          description: |
            Supported transports for the API (http and/or https)
          example:
            - http
            - https
          items:
            type: string
        mtls:
          $ref: '#/components/schemas/MTLSConfig'
        security:
          $ref: '#/components/schemas/SecurityConfig'
        cors:
          $ref: '#/components/schemas/CORSConfig'
        backend-services:
          type: array
          description: List of backend services used by this API
          items:
            $ref: '#/components/schemas/BackendService'
        api-rate-limiting:
          $ref: '#/components/schemas/RateLimitingConfig'
        operations:
          type: array
          description: List of operations exposed by this API
          items:
            $ref: '#/components/schemas/Operation'

    MTLSConfig:
      title: mTLS Configuration
      type: object
      description: Configuration for mutual TLS settings for the API
      properties:
        enabled:
          type: boolean
          description: Whether mutual TLS is enabled
          example: false
        enforceIfClientCertPresent:
          type: boolean
          description: Whether to enforce mTLS if a client certificate is present
          example: false
        verifyClient:
          type: boolean
          description: Whether client verification is enabled
          example: false
        clientCert:
          type: string
          description: Base64-encoded client certificate
          example: "MIIDdTCCAl2gAwIBAgIUOQp4tDq2YVfB4KxwA3kM3G4x7eowDQYJKoZIhvcNAQELBQAwRjELMAkGA1UEBhMCVVMxCzAJBgNVBA"
        clientKey:
          type: string
          description: Base64-encoded client private key
          example: "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDOn1Q3xNQHRb7KmFwB6Y6L6K2B8rwRUKR6dW6iBzF7QdtsdQ"
        caCert:
          type: string
          description: Base64-encoded certificate authority (CA) certificate
          example: "MIIDrzCCApegAwIBAgIUYJzYpJ2Vj3iO6l3P2wq+1O1bS9EwDQYJKoZIhvcNAQELBQAwcDELMAkGA1UEBhMCVVMxCzAJBgNVBAg"

    SecurityConfig:
      title: Security Configuration
      description: Defines security mechanisms (API key, OAuth2) applicable to the API
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether security is enabled
          example: true
        apiKey:
          $ref: '#/components/schemas/APIKeySecurity'
        oauth2:
          $ref: '#/components/schemas/OAuth2Security'

    APIKeySecurity:
      title: API Key Security
      description: Configuration for API keyâ€“based authentication
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether API key authentication is enabled
          example: true
        header:
          type: string
          description: Header name to carry the API key
          example: "api-key"
        query:
          type: string
          description: Query parameter name to carry the API key
          example: "api-key"
        cookie:
          type: string
          description: Cookie name to carry the API key
          example: "api-key"

    OAuth2Security:
      title: OAuth2 Security
      description: Configuration for OAuth 2.0 authentication
      type: object
      properties:
        grantTypes:
          $ref: '#/components/schemas/OAuth2GrantTypes'
        scopes:
          type: array
          description: OAuth2 scopes required for this API
          items:
            type: string
          example:
            - openid
            - profile
            - email

    OAuth2GrantTypes:
      title: OAuth2 Grant Types
      description: Supported OAuth2 grant types for this API
      type: object
      properties:
        authorizationCode:
          $ref: '#/components/schemas/AuthorizationCodeGrant'
        implicit:
          $ref: '#/components/schemas/ImplicitGrant'
        password:
          $ref: '#/components/schemas/PasswordGrant'
        clientCredentials:
          $ref: '#/components/schemas/ClientCredentialsGrant'

    AuthorizationCodeGrant:
      title: OAuth2 Grant Type with Callback
      description: Defines an OAuth2 grant type that uses a callback URL
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether this grant type is enabled
          example: true
        callbackUrl:
          type: string
          description: Callback URL for OAuth2 authorization flow
          example: http://localhost:8080/oauth2/callback

    ImplicitGrant:
      title: OAuth2 Grant Type with Callback
      description: Defines an OAuth2 grant type that uses a callback URL
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether this grant type is enabled
          example: false
        callbackUrl:
          type: string
          description: Callback URL for OAuth2 authorization flow
          example: http://localhost:8080/oauth2/callback

    PasswordGrant:
      title: Password OAuth2 Grant Type
      description: Defines an Password OAuth2 grant type without a callback URL
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether grant type is enabled
          example: false

    ClientCredentialsGrant:
      title: Client Credentials OAuth2 Grant Type
      description: Defines Client Credentials OAuth2 grant type without a callback URL
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether grant type is enabled
          example: false

    CORSConfig:
      title: CORS Configuration
      description: Defines Cross-Origin Resource Sharing (CORS) policy for the API
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether CORS is enabled
          example: true
        allowOrigins:
          type: string
          description: Comma-separated list of allowed origins
          example: "*"
        allowMethods:
          type: string
          description: Comma-separated list of allowed HTTP methods
          example: "GET,PUT,POST,DELETE,HEAD,OPTIONS"
        allowHeaders:
          type: string
          description: Comma-separated list of allowed HTTP headers
          example: "Authorization,Access-Control-Allow-Origin,Content-Type,SOAPAction"
        exposeHeaders:
          type: string
          description: Headers that can be exposed to the browser
          example: ""
        maxAge:
          type: integer
          description: Maximum age (in seconds) for caching preflight requests
          example: 3600
        allowCredentials:
          type: boolean
          description: Whether credentials are allowed in CORS requests
          example: false

    BackendService:
      title: Backend Service
      description: Represents a backend service that handles requests for this API
      type: object
      properties:
        name:
          type: string
          description: Name of the backend service
          example: "default"
        isDefault:
          type: boolean
          description: Whether this backend is the default one
          example: true
        endpoints:
          type: array
          description: List of endpoints in this backend service
          items:
            $ref: '#/components/schemas/BackendEndpoint'
        timeout:
          $ref: '#/components/schemas/TimeoutConfig'
        retries:
          type: integer
          description: Number of retry attempts for failed requests
          example: 3
        loadBalance:
          $ref: '#/components/schemas/LoadBalanceConfig'
        circuitBreaker:
          $ref: '#/components/schemas/CircuitBreakerConfig'

    BackendEndpoint:
      title: Backend Endpoint
      type: object
      description: Defines a single backend endpoint
      properties:
        url:
          type: string
          example: "https://petstore.swagger.io/v2"
        description:
          type: string
          example: "Petstore API Endpoint"
        healthCheck:
          $ref: "#/components/schemas/HealthCheckConfig"
        weight:
          type: integer
          example: 100
        mtls:
          $ref: "#/components/schemas/MTLSConfig"

    HealthCheckConfig:
      title: Health Check Configuration
      type: object
      description: Defines health check parameters for a backend endpoint
      properties:
        enabled:
          type: boolean
          example: true
        interval:
          type: integer
          description: Health check interval in seconds
          example: 60
        timeout:
          type: integer
          description: Timeout in seconds for each health check attempt
          example: 5
        unhealthyThreshold:
          type: integer
          description: Number of failed checks before marking unhealthy
          example: 3
        healthyThreshold:
          type: integer
          description: Number of successful checks before marking healthy
          example: 2

    TimeoutConfig:
      title: Timeout Configuration
      type: object
      description: Timeout settings for the backend connection
      properties:
        connect:
          type: integer
          description: Connection timeout in milliseconds
          example: 5000
        read:
          type: integer
          description: Read timeout in milliseconds
          example: 60000
        write:
          type: integer
          description: Write timeout in milliseconds
          example: 60000

    LoadBalanceConfig:
      title: Load Balancing Configuration
      type: object
      description: Defines load balancing behavior for backend endpoints
      properties:
        algorithm:
          type: string
          description: Load balancing algorithm to use
          example: "ROUND_ROBIN"
        failover:
          type: boolean
          description: Whether to failover to another endpoint on failure
          example: true

    CircuitBreakerConfig:
      title: Circuit Breaker Configuration
      type: object
      description: Circuit breaker settings to manage backend failures
      properties:
        enabled:
          type: boolean
          description: Whether circuit breaker is enabled
          example: false
        maxConnections:
          type: integer
          description: Maximum number of concurrent connections
          example: 10
        maxPendingRequests:
          type: integer
          description: Maximum number of pending requests
          example: 5
        maxRequests:
          type: integer
          description: Maximum number of requests in a given time window
          example: 3
        maxRetries:
          type: integer
          description: Maximum number of retries for a failed request
          example: 1

    RateLimitingConfig:
      title: API Rate Limiting Configuration
      type: object
      description: Defines API rate limiting rules
      properties:
        enabled:
          type: boolean
          description: Whether rate limiting is enabled
          example: true
        rateLimitCount:
          type: integer
          description: Number of requests allowed in the specified time unit
          example: 1000
        rateLimitTimeUnit:
          type: string
          description: Time unit for rate limiting (second, minute, hour)
          enum:
            - second
            - minute
            - hour
          example: "minute"
        stopOnQuotaReach:
          type: boolean
          description: Whether to stop requests when the quota is reached
          example: true

    Operation:
      title: API Operation
      type: object
      description: Defines a single operation (resource) within the API
      properties:
        name:
          type: string
          description: Name of the operation
          example: "getPetById"
        description:
          type: string
          description: Description of the operation
          example: "Find pet by ID"
        request:
          $ref: "#/components/schemas/OperationRequest"

    OperationRequest:
      title: Operation Request
      type: object
      description: Request details for an API operation
      properties:
        method:
          type: string
          description: HTTP method for the operation
          enum:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - HEAD
            - OPTIONS
          example: "GET"
        path:
          type: string
          description: Resource path for the operation
          example: "/pet/{petId}"
        backend-services:
          type: array
          description: List of backend services for this operation
          items:
            $ref: "#/components/schemas/BackendRouting"
        authentication:
          $ref: "#/components/schemas/AuthenticationConfig"
        requestPolicies:
          type: array
          items:
            $ref: "#/components/schemas/Policy"
        responsePolicies:
          type: array
          items:
            $ref: "#/components/schemas/Policy"

    BackendRouting:
      title: Backend Routing
      type: object
      description: Defines routing weights to different backend services
      properties:
        name:
          type: string
          description: Name of the backend service
          example: "default"
        weight:
          type: integer
          description: Traffic weight for this backend service
          example: 80

    AuthenticationConfig:
      title: Authentication Configuration
      type: object
      description: Defines authentication requirements for an operation
      properties:
        required:
          type: boolean
          description: Whether authentication is required
          example: true
        scopes:
          type: array
          description: List of OAuth2 scopes required for this operation
          items:
            type: string
          example: [ "read:pets" ]

    Policy:
      title: Policy Configuration
      type: object
      description: Defines a request or response policy applied at runtime
      properties:
        name:
          type: string
          description: Name of the policy to apply
          example: "SET_HEADER"
        params:
          type: object
          description: Key-value pairs of parameters for the policy
          additionalProperties: true
          example:
            key: "MyHeader"
            value: "MyValue"

    AddGatewayToAPIRequest:
      title: AddGatewayToAPIRequest object with basic gateway details
      type: object
      required:
        - gatewayId
      properties:
        gatewayId:
          type: string
          format: uuid
          example: "987e6543-e21b-45d3-a789-426614174999"

    APIGatewayListResponse:
      type: object
      required:
        - count
        - list
        - pagination
      properties:
        count:
          type: integer
          description: Number of gateways in current response
          example: 3
        list:
          type: array
          description: List of gateways associated with the API, including deployment details when deployed
          items:
            $ref: '#/components/schemas/APIGatewayResponse'
        pagination:
          $ref: '#/components/schemas/Pagination'

    APIGatewayResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/GatewayResponse'
        - type: object
          required:
            - associatedAt
            - isDeployed
          properties:
            associatedAt:
              type: string
              format: date-time
              description: Timestamp when the gateway was associated with the API
              example: "2025-10-15T10:30:00Z"
            isDeployed:
              type: boolean
              description: Whether the API is currently deployed to this gateway
              example: true
            deployment:
              $ref: '#/components/schemas/APIDeploymentDetails'
              description: Deployment details (only present when isDeployed is true)

    APIDeploymentDetails:
      type: object
      description: Details about API deployment to a specific gateway
      required:
        - revisionId
        - status
        - deployedAt
      properties:
        revisionId:
          type: string
          description: ID of the deployed API revision
          example: "c26b2b9b-4632-4ca4-b6f3-521c8863990c"
        status:
          description: Current deployment status
          type: string
          example: CREATED
          default: CREATED
          enum:
            - CREATED
            - APPROVED
            - REJECTED
        deployedAt:
          type: string
          format: date-time
          description: Timestamp when the API was deployed
          example: "2025-10-15T11:00:00Z"

    APIRevisionDeployment:
      title: APIRevisionDeployment Info object with basic API deployment details
      properties:
        revisionId:
          maxLength: 255
          minLength: 0
          type: string
          example: c26b2b9b-4632-4ca4-b6f3-521c8863990c
        gatewayId:
          type: string
          format: uuid
          example: "987e6543-e21b-45d3-a789-426614174999"
        status:
          type: string
          description: Current deployment status
          example: CREATED
          default: CREATED
          enum:
            - CREATED
            - APPROVED
            - REJECTED
        vhost:
          maxLength: 255
          minLength: 1
          # hostname regex as per RFC 1123 (http://tools.ietf.org/html/rfc1123) and appended *
          pattern: '^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$'
          type: string
          example: mg.wso2.com
        displayOnDevportal:
          type: boolean
          example: true
          default: true
        deployedTime:
          readOnly: true
          type: string
          format: date-time
        successDeployedTime:
          readOnly: true
          type: string
          format: date-time
        liveGatewayCount:
          readOnly: true
          type: integer
          description: |
            The number of gateways that are currently live in the gateway environment
          example: 1
        deployedGatewayCount:
          readOnly: true
          type: integer
          description: |
            The number of gateways in which the API revision is deployed successfully
          example: 1
        failedGatewayCount:
          readOnly: true
          type: integer
          description: |
            The number of gateways where the API revision deployment has failed
          example: 1

    CreateGatewayRequest:
      description: |
        Request body for creating a gateway. Organization ID is automatically extracted 
        from the JWT token and does not need to be provided.
      type: object
      required:
        - name
        - displayName
        - vhost
        - isCritical
        - functionalityType
      properties:
        name:
          type: string
          pattern: '^[a-z0-9-]+$'
          minLength: 3
          maxLength: 64
          description: URL-friendly gateway identifier (lowercase alphanumeric with hyphens, unique per organization)
          example: "prod-gateway-01"
        displayName:
          type: string
          minLength: 1
          maxLength: 128
          description: Human-readable gateway name
          example: "Production Gateway 01"
        description:
          type: string
          description: Description of the gateway
          example: "Production gateway for handling API traffic"
        vhost:
          type: string
          description: Virtual host (domain name) for the gateway
          maxLength: 255
          minLength: 1
          # hostname regex as per RFC 1123 (http://tools.ietf.org/html/rfc1123) and appended *
          pattern: '^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$'
          example: mg.wso2.com
        isCritical:
          type: boolean
          description: Whether the gateway is critical for production
          default: false
          example: true
        functionalityType:
          type: string
          enum: [regular, ai, event]
          description: Type of gateway functionality
          default: regular
          example: "regular"

    GatewayResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the gateway
          example: "987e6543-e21b-45d3-a789-426614174999"
        organizationId:
          type: string
          format: uuid
          description: UUID of the organization this gateway belongs to
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          description: URL-friendly gateway identifier
          example: "prod-gateway-01"
        displayName:
          type: string
          description: Human-readable gateway name
          example: "Production Gateway 01"
        description:
          type: string
          description: Description of the gateway
          example: "Production gateway for handling API traffic"
        vhost:
          type: string
          description: Virtual host (domain name) for the gateway
          example: mg.wso2.com
        isCritical:
          type: boolean
          description: Whether the gateway is critical for production
          example: true
        functionalityType:
          type: string
          enum: [regular, ai, event]
          description: Type of gateway functionality
          example: "regular"
        isActive:
          type: boolean
          description: Indicates if the gateway is currently connected to the platform via WebSocket
          example: true
        createdAt:
          type: string
          format: date-time
          description: Timestamp when gateway was registered
          example: "2025-10-14T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when gateway was last updated
          example: "2025-10-14T10:30:00Z"

    UpdateGatewayRequest:
      type: object
      properties:
        displayName:
          type: string
          minLength: 1
          maxLength: 128
          description: Human-readable gateway name
          example: "Updated Production Gateway"
        description:
          type: string
          description: Description of the gateway
          example: "Updated gateway description"
        isCritical:
          type: boolean
          description: Whether the gateway is critical for production
          example: true

    Pagination:
      type: object
      required:
        - total
        - offset
        - limit
      properties:
        total:
          type: integer
          description: Total number of items available across all pages
          example: 10
        offset:
          type: integer
          description: Zero-based index of first item in current response
          example: 0
        limit:
          type: integer
          description: Maximum number of items returned per page
          example: 10

    GatewayListResponse:
      title: GatewayListResponse for paginated gateway results
      type: object
      required:
        - count
        - list
        - pagination
      properties:
        count:
          type: integer
          description: Number of items in current response
          example: 2
        list:
          type: array
          items:
            $ref: '#/components/schemas/GatewayResponse'
        pagination:
          $ref: '#/components/schemas/Pagination'

    GatewayStatusResponse:
      type: object
      description: Lightweight gateway status information optimized for frequent polling
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the gateway
          example: "987e6543-e21b-45d3-a789-426614174999"
        name:
          type: string
          description: URL-friendly gateway identifier
          example: "prod-gateway-01"
        isActive:
          type: boolean
          description: Indicates if the gateway is currently connected to the platform via WebSocket
          example: true
        isCritical:
          type: boolean
          description: Whether the gateway is critical for production
          example: true

    GatewayStatusListResponse:
      type: object
      description: List of gateway status information for polling
      required:
        - count
        - list
        - pagination
      properties:
        count:
          type: integer
          description: Number of items in current response
          example: 2
        list:
          type: array
          items:
            $ref: '#/components/schemas/GatewayStatusResponse'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ProjectListResponse:
      type: object
      required:
        - count
        - list
        - pagination
      properties:
        count:
          type: integer
          description: Number of items in current response
          example: 2
        list:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        pagination:
          $ref: '#/components/schemas/Pagination'

    APIListResponse:
      type: object
      required:
        - count
        - list
        - pagination
      properties:
        count:
          type: integer
          description: Number of items in current response
          example: 2
        list:
          type: array
          items:
            $ref: '#/components/schemas/API'
        pagination:
          $ref: '#/components/schemas/Pagination'

    TokenRotationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ID of the newly generated token
          example: "def45678-g901-23hi-j456-789012klmnop"
        token:
          type: string
          description: Plain-text new authentication token (only exposed once during rotation)
          example: "nM8pQ1rT4vW7yZ0bC3eF6hI9kL2nO5qR8tU1wX4zA7cE0fH3jK6mP9sV2yB5dG8i"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when new token was created
          example: "2025-10-15T14:20:00Z"
        message:
          type: string
          description: Informational message about token rotation
          example: "New token generated successfully. Old token remains active until revoked."

    GitRepoBranchesRequest:
      type: object
      required:
        - repoUrl
      properties:
        repoUrl:
          type: string
          format: uri
          description: URL of the public Git repository to fetch branches from
          example: "https://github.com/example-org/sample-api"
        provider:
          type: string
          enum: ["github", "gitlab", "bitbucket"]
          description: Git provider (optional - will be auto-detected if not provided)
          example: "github"

    GitRepoBranchesResponse:
        type: object
        required:
          - repoUrl
          - branches
        properties:
          repoUrl:
            type: string
            format: uri
            description: URL of the repository that was fetched
            example: "https://github.com/example-org/sample-api"
          branches:
            type: array
            items:
              $ref: '#/components/schemas/GitRepoBranch'

    GitRepoBranch:
      type: object
      required:
        - name
        - isDefault
      properties:
        name:
          type: string
          description: Name of the branch
          example: "main"
        isDefault:
          type: string
          description: Whether this branch is the default branch
          example: "true"

    GitRepoContentRequest:
      type: object
      required:
        - repoUrl
        - branch
      properties:
        repoUrl:
          type: string
          format: uri
          description: URL of the public Git repository to fetch content from
          example: "https://github.com/example-org/sample-api"
        branch:
          type: string
          description: Branch of the repository to fetch content from
          example: "main"
        provider:
          type: string
          enum: ["github", "gitlab", "bitbucket"]
          description: Git provider (optional - will be auto-detected if not provided)
          example: "github"

    GitRepoContentResponse:
      type: object
      required:
        - repoUrl
        - branch
        - items
        - totalItems
        - maxDepth
        - requestedDepth
      properties:
        repoUrl:
          type: string
          format: uri
          description: URL of the repository that was fetched
          example: "https://github.com/example-org/sample-api"
        branch:
          type: string
          description: Branch of the repository that was fetched
          example: "main"
        items:
          type: array
          items:
            $ref: '#/components/schemas/GitRepoItem'
          description: List of files and directories in the repository
        totalItems:
          type: integer
          description: Total number of items returned
          example: 15
        maxDepth:
          type: integer
          description: Maximum depth level that was actually traversed
          example: 2
        requestedDepth:
          type: integer
          description: Requested depth level (0 = unlimited)
          example: 2

    GitRepoItem:
      type: object
      required:
        - path
        - subPath
        - children
        - type
      properties:
        path:
          type: string
          description: Full path of the item within the repository
          example: "docs/README.md"
        subPath:
          type: string
          description: Name of the item (file or directory)
          example: "README.md"
        children:
          type: array
          items:
            $ref: '#/components/schemas/GitRepoItem'
        type:
          type: string
          description: Type of the item (file or directory)
          enum: [ tree, blob, EOF ]
          example: "tree"

    GitRepoError:
      type: object
      required:
        - error
        - code
        - message
      properties:
        error:
          type: string
          description: High-level error type
          example: "FETCH_FAILED"
        code:
          type: string
          description: Specific error code for programmatic handling
          example: "GIT_003"
        message:
          type: string
          description: Human-readable error message
          example: "Repository not found or is private"

    TokenInfoResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Token UUID
          example: "abc12345-f678-90de-f123-456789abcdef"
        status:
          type: string
          enum: [active, revoked]
          description: Current token status
          example: "active"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when token was created
          example: "2025-10-14T10:30:00Z"
        revokedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when token was revoked (null if active)
          example: null

    CreateAPIRequest:
      allOf:
        - $ref: '#/components/schemas/API'
        - type: object
          required:
            - name
            - context
            - version
            - projectId

    UpdateAPIRequest:
      allOf:
        - $ref: '#/components/schemas/API'

    Error:
      title: Error object returned
      required:
        - code
        - message
      type: object
      properties:
        code:
          type: integer
          format: int64
        message:
          type: string
          description: Error message
        description:
          type: string
          description: A detailed description about the error message

    GatewayArtifact:
      type: object
      required:
        - id
        - name
        - type
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the artifact
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          description: Name of the artifact
          example: "inventory-api"
        displayName:
          type: string
          description: Display name of the artifact
          example: "Inventory Management API"
        type:
          type: string
          enum: ["API", "MCP", "API_PRODUCT"]
          description: Type of artifact deployed to the gateway
          example: "API"
        subType:
          type: string
          enum: ["REST", "ASYNC", "GQL", "WEBSOCKET", "SOAP"]
          description: Subtype of the artifact (for APIs - type of API)
          example: "REST"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the artifact was created
          example: "2025-10-27T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the artifact was last updated
          example: "2025-10-27T11:45:00Z"

    GatewayArtifactListResponse:
      type: object
      required:
        - count
        - list
        - pagination
      properties:
        count:
          type: integer
          description: Number of items in current response
          example: 5
        list:
          type: array
          description: Array of gateway artifact objects
          items:
            $ref: '#/components/schemas/GatewayArtifact'
        pagination:
          $ref: '#/components/schemas/Pagination'

    PublishAPIResponse:
      type: object
      required:
        - message
        - apiId
        - apiPortalRefId
        - publishedAt
      properties:
        message:
          type: string
          description: Human-readable success message
          example: "API published successfully to API portal"
        apiId:
          type: string
          format: uuid
          description: Platform-api API identifier
          example: "1f01c9b2-440b-4cfe-bf48-f8f168062df4"
        apiPortalRefId:
          type: string
          description: API portal reference ID for the published API
          example: "1f01c9b2-440b-4cfe-bf48-f8f168062df4"
        publishedAt:
          type: string
          format: date-time
          description: Timestamp of publication
          example: "2025-10-29T21:25:09.418859918+05:30"

    UnpublishAPIResponse:
      type: object
      required:
        - message
        - apiId
        - unpublishedAt
      properties:
        message:
          type: string
          description: Human-readable success message
          example: "API unpublished successfully from API portal"
        apiId:
          type: string
          format: uuid
          description: Platform-api API identifier
          example: "1f01c9b2-440b-4cfe-bf48-f8f168062df4"
        unpublishedAt:
          type: string
          format: date-time
          description: Timestamp when API was unpublished
          example: "2025-10-29T21:08:59.834784232+05:30"
    
    ImportAPIProjectRequest:
        type: object
        required:
            - repoUrl
            - branch
            - path
            - api
        properties:
          repoUrl:
            type: string
            format: uri
            description: URL of the public Git repository
            example: "https://github.com/example-org/sample-api"
          provider:
            type: string
            enum: [ "github", "gitlab", "bitbucket" ]
            description: Git provider (optional - will be auto-detected if not provided)
            example: "github"
          branch:
            type: string
            description: Branch of the repository to import from
            example: "main"
          path:
            type: string
            description: Path within the repository where the API project is located
            example: "apis/inventory-api"
          api:
            allOf:
              - $ref: '#/components/schemas/API'
              - type: object
                description: API details for the imported project
                required:
                  - name
                  - context
                  - version
                  - projectId

  responses:
    Unauthorized:
      description: Unauthorized. Authentication credentials are missing or invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 401
            message: Unauthorized
            description: Authorization header is required or token is invalid

    BadRequest:
      description: Bad Request. Invalid request or validation error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 400
            message: Bad Request
            description: Invalid request or validation error
    NotFound:
      description: Not Found. The specified resource does not exist.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 404
            message: Not Found
            description: The specified resource does not exist
    Conflict:
      description: Conflict. Specified resource already exists.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 409
            message: Conflict
            description: Specified resource already exists
    InternalServerError:
      description: Internal Server Error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 500
            message: Internal Server Error
            description: The server encountered an internal error. Please contact
              administrator.
  parameters:
    OrganizationID:
      name: orgId
      in: path
      required: true
      description: |
        **Organization ID** consisting of the **UUID** of the Organization.
      schema:
        type: string
        format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"

    ProjectID:
      name: projectId
      in: path
      required: true
      description: |
        **Project ID** consisting of the **UUID** of the Project.
      schema:
        type: string
        format: uuid
        example: "yr434567-de34-76uj6-w376-234324532"

    apiID:
      name: apiId
      in: path
      description: |
        **API ID** consisting of the **UUID** of the API.
      required: true
      schema:
        type: string
        format: uuid
        example: ivbda7385-chs529-63bf-8bd2-7437690

    revisionId-Q:
      name: revisionId
      in: query
      description: |
        Revision ID of an API
      schema:
        type: string
        format: uuid
        example: crer4354-jui52345-245vd-93fvk-137063

    projectId-Q:
      name: projectId
      in: query
      required: false
      description: |
        **Project ID** consisting of the **UUID** of the Project to filter APIs by.
      schema:
        type: string
        format: uuid
        example: "yr434567-de34-76uj6-w376-234324532"

    gatewayId-Q:
      name: gatewayId
      in: query
      required: false
      description: |
        **Gateway ID** consisting of the **UUID** of the Gateway to filter status by.
      schema:
        type: string
        format: uuid
        example: "987e6543-e21b-45d3-a789-426614174999"

    GatewayID:
      name: gatewayId
      in: path
      required: true
      description: |
        **Gateway ID** consisting of the **UUID** of the Gateway.
      schema:
        type: string
        format: uuid
        example: "987e6543-e21b-45d3-a789-426614174999"

    TokenID:
      name: tokenId
      in: path
      required: true
      description: |
        **Token ID** consisting of the **UUID** of the Token.
      schema:
        type: string
        format: uuid
        example: "abc12345-f678-90de-f123-456789abcdef"

    ArtifactType-Q:
      name: artifactType
      in: query
      required: false
      description: Filter artifacts by type
      schema:
        type: string
        enum: ["API", "MCP", "API_PRODUCT"]
      example: "API"

    depth-Q:
      name: depth
      in: query
      required: false
      description: |
        Limits the depth of directory traversal when fetching Git repository content.
        - `0` or omitted: Returns all content (unlimited depth)
        - `1`: Returns only root-level files and directories
        - `2`: Returns content within two levels from the root
        - Maximum allowed depth is 10 for performance reasons
      schema:
        type: integer
        minimum: 0
        maximum: 10
        default: 0
      example: 2

tags:
  - name: Health
    description: Health check endpoints
  - name: Organizations
    description: Organization management operations
  - name: Projects
    description: Project management operations
  - name: APIs
    description: API management operations
  - name: API Revisions
    description: API revision deployment operations
  - name: API Portal
    description: API portal publishing and unpublishing operations
  - name: Gateways
    description: Gateway registration and management operations
  - name: Gateway Tokens
    description: Gateway token rotation and revocation operations
