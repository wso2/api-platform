openapi: 3.1.1
info:
  title: Internal API
  description: |
    Internal API used to handle requests which are not supposed to be exposed publicly.
  version: 1.0.0
  contact:
    name: WSO2 API Platform Team
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: https://localhost:9243/internal/v1
    description: Development server (HTTPS)

security: []

paths:
  /token/introspect:
    post:
      summary: Introspect a token
      description: |
        Validates a token generated by the Platform API and returns metadata about its status.
      operationId: IntrospectToken
      tags:
        - Tokens
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/IntrospectTokenRequest'
            example:
              token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Token introspected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntrospectTokenResponse'
              example:
                active: true
                scope: "read:projects write:projects"
                clientId: "client-123"
                username: "jane.doe"
                tokenType: "access_token"
                exp: 1737580800
                iat: 1737577200
                nbf: 1737577200
                sub: "user-123"
                aud:
                  - "orgHandle/gatewayHandle"
                iss: "https://auth.platform.com"
                jti: "c6f4a6a1-9f73-4edc-ae33-1d1b2a50f9b0"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid or missing credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:

  schemas:
    IntrospectTokenRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          description: The token to introspect.
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    IntrospectTokenResponse:
      type: object
      required:
        - active
        - aud
      properties:
        active:
          type: boolean
          description: Indicates whether the token is active.
          example: true
        scope:
          type: string
          description: Space-delimited list of scopes.
          example: "read:projects write:projects"
        aud:
          type: array
          description: Audience list.
          items:
            type: string
          example:
            - orgHandle/gatewayHandle

    ErrorResponse:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          description: HTTP status code
          example: 400
        message:
          type: string
          description: Error message
          example: Bad Request
        description:
          type: string
          description: Detailed error description
          example: Token is required
      description: Standard error response format used across all endpoints

tags:
  - name: Tokens
    description: Internal endpoints used to introspect tokens issued by the Platform API.
